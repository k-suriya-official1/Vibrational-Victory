<!DOCTYPE html>
<html>
<head>
  <title>To-Do List</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
    }
  </style>
</head>
<body>
  <h1>To-Do List</h1>
  <form id="taskForm">
    <input type="text" id="task" placeholder="Task" required>
    <input type="date" id="dueDate" required>
    <input type="time" id="dueTime" required>
    <input type="number" id="priority" placeholder="Priority" required>
    <button type="submit">Add Task</button>
  </form>
  <br>
  <table id="tasksTable">
    <thead>
      <tr>
        <th>Task</th>
        <th>Due DateTime</th>
        <th>Priority</th>
        <th>Done</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Tasks will be populated here -->
    </tbody>
  </table>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxv-vyI0SCWSsxGwHcwWLDbdgzwN2NfsyfKCxVK01-QJfwo2ykm6uZSdgQbVzrhyuYDVQ/exec'; // Replace with your Web App URL

    document.getElementById('taskForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const task = document.getElementById('task').value;
      const dueDate = document.getElementById('dueDate').value;
      const dueTime = document.getElementById('dueTime').value;
      const priority = document.getElementById('priority').value;

      await fetch(`${API_URL}?action=add&task=${encodeURIComponent(task)}&dueDate=${encodeURIComponent(dueDate)}&dueTime=${encodeURIComponent(dueTime)}&priority=${encodeURIComponent(priority)}`);
      loadTasks();
      this.reset();
    });

    async function loadTasks() {
      const res = await fetch(`${API_URL}?action=list`);
      const tasks = await res.json();

      const tbody = document.querySelector('#tasksTable tbody');
      tbody.innerHTML = '';

      tasks.forEach(t => {
        const row = document.createElement('tr');

        const taskCell = document.createElement('td');
        taskCell.textContent = t['Task'];
        row.appendChild(taskCell);

        const dueDateTimeCell = document.createElement('td');
        dueDateTimeCell.textContent = t['Due DateTime'];
        row.appendChild(dueDateTimeCell);

        const priorityCell = document.createElement('td');
        priorityCell.textContent = t['Priority'];
        row.appendChild(priorityCell);

        const doneCell = document.createElement('td');
        doneCell.textContent = t['Done'];
        row.appendChild(doneCell);

        const actionsCell = document.createElement('td');

        const doneButton = document.createElement('button');
        doneButton.textContent = 'Done';
        doneButton.addEventListener('click', async () => {
          await fetch(`${API_URL}?action=update&task=${encodeURIComponent(t['Task'])}&done=true`);
          loadTasks();
        });
        actionsCell.appendChild(doneButton);

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.addEventListener('click', async () => {
          await fetch(`${API_URL}?action=delete&task=${encodeURIComponent(t['Task'])}`);
          loadTasks();
        });
        actionsCell.appendChild(deleteButton);

        row.appendChild(actionsCell);

        tbody.appendChild(row);
      });
    }

    // Initial load
    loadTasks();
  </script>
</body>
</html>
